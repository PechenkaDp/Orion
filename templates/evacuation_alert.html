<div id="evacuationAlert" class="evacuation-alert" style="display: none;">
    <div class="evacuation-alert-content">
        <div class="evacuation-icon">üö®</div>
        <div class="evacuation-message">
            <h3 id="evacuationTitle">–í–Ω–∏–º–∞–Ω–∏–µ! –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —ç–≤–∞–∫—É–∞—Ü–∏—è!</h3>
            <p id="evacuationMessage">–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —ç–≤–∞–∫—É–∞—Ü–∏—è –∏–∑ –∑–¥–∞–Ω–∏—è. –°–ª–µ–¥—É–π—Ç–µ —É–∫–∞–∑–∞–Ω–∏—è–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ª–∏—Ü.</p>
        </div>
        <button id="evacuationClose" class="evacuation-close">&times;</button>
    </div>
</div>

<style>
    .evacuation-alert {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background-color: rgba(244, 67, 54, 0.95);
        color: white;
        z-index: 9999;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        animation: blink-alert 1s infinite;
    }

    @keyframes blink-alert {
        0% { background-color: rgba(244, 67, 54, 0.95); }
        50% { background-color: rgba(211, 47, 47, 0.95); }
        100% { background-color: rgba(244, 67, 54, 0.95); }
    }

    .evacuation-alert-content {
        display: flex;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
    }

    .evacuation-icon {
        font-size: 36px;
        margin-right: 20px;
        animation: pulse 1s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }

    .evacuation-message {
        flex: 1;
    }

    .evacuation-message h3 {
        margin: 0 0 10px 0;
        font-size: 20px;
    }

    .evacuation-message p {
        margin: 0;
    }

    .evacuation-close {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        opacity: 0.8;
    }

    .evacuation-close:hover {
        opacity: 1;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function checkEvacuationAlerts() {
            fetch('{% url "api_evacuation_check" %}')
                .then(response => response.json())
                .then(data => {
                    const alertElement = document.getElementById('evacuationAlert');

                    if (data.has_evacuation && data.evacuations.length > 0) {
                        // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤–æ–µ (—Å–∞–º–æ–µ –Ω–æ–≤–æ–µ) —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        const evacuation = data.evacuations[0];

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                        document.getElementById('evacuationTitle').textContent = evacuation.title;
                        document.getElementById('evacuationMessage').textContent = evacuation.message;

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        alertElement.style.display = 'block';

                        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫–æ–≤–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
                        playAlertSound();
                    } else {
                        // –°–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö
                        alertElement.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± —ç–≤–∞–∫—É–∞—Ü–∏–∏:', error);
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
        function playAlertSound() {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∞—É–¥–∏–æ
            const audio = new Audio('/static/sounds/alarm.mp3');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∑–≤—É–∫
            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –±—Ä–∞—É–∑–µ—Ä–æ–º');
                });
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
        document.getElementById('evacuationClose').addEventListener('click', function() {
            document.getElementById('evacuationAlert').style.display = 'none';
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkEvacuationAlerts();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
        setInterval(checkEvacuationAlerts, 15000);
    });
</script>
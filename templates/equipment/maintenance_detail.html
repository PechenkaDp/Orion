{% extends 'base.html' %}
{% load static %}
{% block title %}–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ: {{ maintenance.equipment.name }} | –û—Ä–∏–æ–Ω{% endblock %}
{% block content %}
<div class="page-header">
    <h1>–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h1>
    <div class="action-buttons">
        <a href="{% url 'maintenance_update' maintenance.id %}" class="action-btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'equipment_detail' maintenance.equipment.id %}" class="action-btn">–ö –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é</a>
    </div>
</div>
<div class="detail-container">
    <div class="detail-card">
        <div class="detail-header">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏</h2>
        </div>
        <div class="detail-content">
        <div class="detail-row">
            <div class="detail-label">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:</div>
            <div class="detail-value">{{ maintenance.equipment.name }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–ú–æ–¥–µ–ª—å:</div>
            <div class="detail-value">{{ maintenance.equipment.model|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä:</div>
            <div class="detail-value">{{ maintenance.equipment.serial_number|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–¢–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:</div>
            <div class="detail-value">{{ maintenance.maintenance_type }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–î–∞—Ç–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:</div>
            <div class="detail-value">{{ maintenance.maintenance_date|date:"d.m.Y H:i" }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–í—ã–ø–æ–ª–Ω–∏–ª:</div>
            <div class="detail-value">{{ maintenance.performed_by.last_name }} {{ maintenance.performed_by.first_name }}</div>
        </div>
        {% if maintenance.description %}
        <div class="detail-row">
            <div class="detail-label">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</div>
            <div class="detail-value">{{ maintenance.description }}</div>
        </div>
        {% endif %}
        <div class="detail-row">
            <div class="detail-label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
            <div class="detail-value">{{ maintenance.result }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:</div>
            <div class="detail-value {% if maintenance.next_maintenance_date and maintenance.next_maintenance_date < current_date %}overdue{% endif %}">
                {{ maintenance.next_maintenance_date|date:"d.m.Y"|default:"–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ" }}
                {% if maintenance.next_maintenance_date and maintenance.next_maintenance_date < current_date %}
                <span class="status-badge status-urgent">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                {% endif %}
            </div>
        </div>
        {% if maintenance.documents_path %}
        <div class="detail-row">
            <div class="detail-label">–î–æ–∫—É–º–µ–Ω—Ç—ã:</div>
            <div class="detail-value">
                <a href="{{ maintenance.documents_path }}" class="file-link" target="_blank">–°–∫–∞—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</a>
            </div>
        </div>
        {% endif %}
        {% if maintenance.notes %}
        <div class="detail-row">
            <div class="detail-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</div>
            <div class="detail-value">{{ maintenance.notes }}</div>
        </div>
        {% endif %}
    </div>
</div>

<div class="detail-card">
    <div class="detail-header">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è {{ maintenance.equipment.name }}</h2>
    </div>
    <div class="detail-content">
        <table class="detail-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–¢–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</th>
                    <th>–í—ã–ø–æ–ª–Ω–∏–ª</th>
                    <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for record in equipment_maintenance_history %}
                <tr {% if record.id == maintenance.id %}class="active-row"{% endif %}>
                    <td>{{ record.maintenance_date|date:"d.m.Y" }}</td>
                    <td>{{ record.maintenance_type }}</td>
                    <td>{{ record.performed_by.last_name }} {{ record.performed_by.first_name }}</td>
                    <td>{{ record.result }}</td>
                    <td>
                        <a href="{% url 'maintenance_detail' record.id %}" class="icon-btn" title="–ü—Ä–æ—Å–º–æ—Ç—Ä"><span class="btn-icon">üëÅÔ∏è</span></a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="empty-table">–ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</div>
<style>
    .overdue {
        color: #f44336;
        font-weight: bold;
    }

    .active-row {
        background-color: #fff8e1;
    }

    .file-link {
        color: #ff7a00;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
    }

    .file-link:hover {
        text-decoration: underline;
    }

    .file-link:before {
        content: 'üìÑ';
        margin-right: 5px;
    }
</style>
{% endblock %}
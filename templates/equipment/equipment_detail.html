{% extends 'base.html' %}
{% load static %}

{% block title %}–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: {{ equipment.name }} | –û—Ä–∏–æ–Ω{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ equipment.name }}</h1>
    <div class="action-buttons">
        <a href="{% url 'equipment_update' equipment.id %}" class="action-btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'equipment_maintenance' equipment.id %}" class="action-btn">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</a>
        <a href="{% url 'equipment_delete' equipment.id %}" class="action-btn btn-danger">–£–¥–∞–ª–∏—Ç—å</a>
    </div>
</div>

<div class="detail-container">
    <div class="detail-card">
        <div class="detail-header">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏</h2>
            <span class="status-badge {% if equipment.status == 'operational' %}status-operational{% elif equipment.status == 'requires_maintenance' %}status-requires{% elif equipment.status == 'under_maintenance' %}status-under{% elif equipment.status == 'decommissioned' %}status-decommissioned{% endif %}">
                {% if equipment.status == 'operational' %}–ò—Å–ø—Ä–∞–≤–Ω–æ{% elif equipment.status == 'requires_maintenance' %}–¢—Ä–µ–±—É–µ—Ç—Å—è –¢–û{% elif equipment.status == 'under_maintenance' %}–ù–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏{% elif equipment.status == 'decommissioned' %}–í—ã–≤–µ–¥–µ–Ω–æ –∏–∑ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏{% endif %}
            </span>
        </div>
        
        <div class="detail-content">
            <div class="detail-row">
                <div class="detail-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</div>
                <div class="detail-value">{{ equipment.name }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–¢–∏–ø –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:</div>
                <div class="detail-value">{{ equipment.equipment_type }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–ú–æ–¥–µ–ª—å:</div>
                <div class="detail-value">{{ equipment.model|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä:</div>
                <div class="detail-value">{{ equipment.serial_number|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å:</div>
                <div class="detail-value">{{ equipment.manufacturer|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–î–∞—Ç–∞ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è:</div>
                <div class="detail-value">{{ equipment.purchase_date|date:"d.m.Y"|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–û–∫–æ–Ω—á–∞–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏:</div>
                <div class="detail-value">{{ equipment.warranty_expiry_date|date:"d.m.Y"|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:</div>
                <div class="detail-value">{{ equipment.department.name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</div>
                <div class="detail-value">{{ equipment.location|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª–∏—Ü–æ:</div>
                <div class="detail-value">{{ equipment.responsible_person|default:"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¢–û:</div>
                <div class="detail-value">{{ equipment.last_maintenance_date|date:"d.m.Y"|default:"–ù–µ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å" }}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">–°–ª–µ–¥—É—é—â–µ–µ –¢–û:</div>
                <div class="detail-value {% if equipment.next_maintenance_date and equipment.next_maintenance_date < current_date %}overdue{% endif %}">
                    {{ equipment.next_maintenance_date|date:"d.m.Y"|default:"–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ" }}
                    {% if equipment.next_maintenance_date and equipment.next_maintenance_date < current_date %}
                    <span class="status-badge status-urgent">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                    {% endif %}
                </div>
            </div>
            {% if equipment.notes %}
            <div class="detail-row">
                <div class="detail-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</div>
                <div class="detail-value">{{ equipment.notes }}</div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="detail-card">
        <div class="detail-header">
            <h2>–ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</h2>
            <a href="{% url 'equipment_maintenance' equipment.id %}" class="action-btn">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</a>
        </div>
        <div class="detail-content">
            <table class="detail-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–¢–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</th>
                        <th>–í—ã–ø–æ–ª–Ω–∏–ª</th>
                        <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                        <th>–°–ª–µ–¥—É—é—â–µ–µ –¢–û</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for maintenance in maintenance_history %}
                    <tr>
                        <td>{{ maintenance.maintenance_date|date:"d.m.Y" }}</td>
                        <td>{{ maintenance.maintenance_type }}</td>
                        <td>{{ maintenance.performed_by.last_name }} {{ maintenance.performed_by.first_name }}</td>
                        <td>{{ maintenance.result }}</td>
                        <td>{{ maintenance.next_maintenance_date|date:"d.m.Y"|default:"–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ" }}</td>
                        <td>
                            <a href="{% url 'maintenance_detail' maintenance.id %}" class="icon-btn" title="–ü—Ä–æ—Å–º–æ—Ç—Ä"><span class="btn-icon">üëÅÔ∏è</span></a>
                            <a href="{% url 'maintenance_update' maintenance.id %}" class="icon-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><span class="btn-icon">‚úèÔ∏è</span></a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="empty-table">–ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="detail-card">
        <div class="detail-header">
            <h2>–ì—Ä–∞—Ñ–∏–∫ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</h2>
        </div>
        <div class="detail-content">
            <div class="chart-container">
                <canvas id="maintenanceChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<style>
    .status-operational {
        background-color: #e6f7e6;
        color: #4caf50;
    }
    .status-requires {
        background-color: #fff5e6;
        color: #ff9800;
    }
    .status-under {
        background-color: #e6f4ff;
        color: #2196f3;
    }
    .status-decommissioned {
        background-color: #ffe6e6;
        color: #f44336;
    }
    
    .overdue {
        color: #f44336;
        font-weight: bold;
    }
    
    .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
    }
</style>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ (–∑–∞–≥–ª—É—à–∫–∞, –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –∏–∑ view)
        var maintenanceData = {
            labels: [{% for m in maintenance_history %}'{{ m.maintenance_date|date:"d.m.Y" }}',{% endfor %}],
            datasets: [{
                label: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
                data: [{% for m in maintenance_history %}1,{% endfor %}],
                backgroundColor: '#ff7a00',
                borderColor: '#ff7a00',
                borderWidth: 1
            }]
        };

        var ctx = document.getElementById('maintenanceChart').getContext('2d');
        var maintenanceChart = new Chart(ctx, {
            type: 'bar',
            data: maintenanceData,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 2,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    }
                }
            }
        });
    });
</script>
{% endblock %}
{% endblock %}
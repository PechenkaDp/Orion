{% extends 'reports/custom_report.html' %}
{% load static %}

{% block title %}–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç | –û—Ä–∏–æ–Ω{% endblock %}

{% block content %}
<div class="page-header">
    <h1>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h1>
    <div class="action-buttons">
        <button class="action-btn" onclick="window.print()">–ü–µ—á–∞—Ç—å</button>
        <button class="action-btn">–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</button>
        <button class="action-btn">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
    </div>
</div>

<div class="report-header">
    <div class="report-date">–û—Ç—á–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω: {% now "d.m.Y H:i" %}</div>
    <div class="report-date">–ü–µ—Ä–∏–æ–¥: {% if date_from %}{{ date_from }}{% else %}01.{% now "m.Y" %}{% endif %} - {% if date_to %}{{ date_to }}{% else %}{% now "d.m.Y" %}{% endif %}</div>
</div>

<div class="report-content">
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <div class="card-header">
                <div class="card-icon">üìä</div>
                –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–∞ –º–µ—Å—è—Ü
            </div>
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-value">{{ incident_free_days|default:"30" }}</div>
                    <div class="stat-label">–î–Ω–µ–π –±–µ–∑ –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–π</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">{{ instruction_count|default:"5" }}</div>
                    <div class="stat-label">–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">{{ compliance_percentage|default:"95" }}%</div>
                    <div class="stat-label">–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-card">
            <div class="card-header">
                <div class="card-icon">‚ö†Ô∏è</div>
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∏—Å–∫–æ–≤
            </div>
            <div class="chart-container">
                <canvas id="risksChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <div class="section-title">–ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏</div>
    
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–¢–∏–ø –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∞</th>
                    <th>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</th>
                    <th>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>05.03.2025</td>
                    <td>–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂</td>
                    <td>–¶–µ—Ö ‚Ññ1</td>
                    <td>12</td>
                    <td>–ò–≤–∞–Ω–æ–≤ –ò.–ò.</td>
                </tr>
                <tr>
                    <td>10.03.2025</td>
                    <td>–í–≤–æ–¥–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂</td>
                    <td>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è</td>
                    <td>3</td>
                    <td>–ü–µ—Ç—Ä–æ–≤ –ü.–ü.</td>
                </tr>
                <tr>
                    <td>15.03.2025</td>
                    <td>–í–Ω–µ–ø–ª–∞–Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂</td>
                    <td>–°–∫–ª–∞–¥</td>
                    <td>8</td>
                    <td>–°–∏–¥–æ—Ä–æ–≤ –°.–°.</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="section-title">–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è</div>
    
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    <th>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
                    <th>–¢—è–∂–µ—Å—Ç—å</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>07.03.2025</td>
                    <td>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</td>
                    <td>–¶–µ—Ö ‚Ññ1</td>
                    <td>–°—Ä–µ–¥–Ω—è—è</td>
                    <td>–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ</td>
                </tr>
                <tr>
                    <td>12.03.2025</td>
                    <td>–ó–∞–≥—Ä–æ–º–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–æ–≤</td>
                    <td>–°–∫–ª–∞–¥</td>
                    <td>–°—Ä–µ–¥–Ω—è—è</td>
                    <td>–í —Ä–∞–±–æ—Ç–µ</td>
                </tr>
                <tr>
                    <td>20.03.2025</td>
                    <td>–ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</td>
                    <td>–¶–µ—Ö ‚Ññ1</td>
                    <td>–í—ã—Å–æ–∫–∞—è</td>
                    <td>–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="report-actions">
    <button class="action-btn" onclick="window.history.back()">–ù–∞–∑–∞–¥</button>
    <button class="action-btn" onclick="window.print()">–ü–µ—á–∞—Ç—å</button>
</div>

<style>
    .report-header {
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }
    
    .report-date {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
    }
    
    .chart-container {
        height: 300px;
        position: relative;
    }
    
    .report-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
    }
    
    .report-actions .action-btn {
        margin-left: 10px;
    }
</style>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∏—Å–∫–æ–≤
        var risksCtx = document.getElementById('risksChart').getContext('2d');
        var risksChart = new Chart(risksCtx, {
            type: 'pie',
            data: {
                labels: ['–ù–∏–∑–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–í—ã—Å–æ–∫–∏–π', '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π'],
                datasets: [{
                    data: [30, 45, 20, 5],
                    backgroundColor: [
                        '#4caf50',
                        '#ff9800',
                        '#f44336',
                        '#9c0006'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    }
                }
            }
        });
    });
</script>
{% endblock %}
{% endblock %}
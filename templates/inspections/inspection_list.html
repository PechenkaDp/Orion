{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ–≤–µ—Ä–∫–∏ | –û—Ä–∏–æ–Ω{% endblock %}

{% block content %}
<div class="page-header">
    <h1>–ü—Ä–æ–≤–µ—Ä–∫–∏</h1>
    <button class="action-btn" onclick="location.href='{% url 'inspection_create' %}'">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
</div>

<div class="filter-bar">
    <form method="get" action="{% url 'inspection_list' %}">
        <div class="filter-group">
            <label for="status">–°—Ç–∞—Ç—É—Å:</label>
            <select name="status" id="status" class="form-control" onchange="this.form.submit()">
                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                <option value="new" {% if status_filter == 'new' %}selected{% endif %}>–ù–æ–≤–∞—è</option>
                <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
                <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option>
                <option value="canceled" {% if status_filter == 'canceled' %}selected{% endif %}>–û—Ç–º–µ–Ω–µ–Ω–∞</option>
            </select>
        </div>
    </form>
</div>

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–¢–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                <th>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
                <th>–ü–µ—Ä–∏–æ–¥</th>
                <th>–ü—Ä–æ–≤–µ—Ä—è—é—â–∏–π</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ù–∞—Ä—É—à–µ–Ω–∏—è</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for inspection in page_obj %}
            <tr>
                <td>{{ inspection.title }}</td>
                <td>{{ inspection.inspection_type }}</td>
                <td>{{ inspection.department.name }}</td>
                <td>
                    {{ inspection.start_date|date:"d.m.Y" }}
                    {% if inspection.end_date %}- {{ inspection.end_date|date:"d.m.Y" }}{% endif %}
                </td>
                <td>{{ inspection.lead_inspector.last_name }} {{ inspection.lead_inspector.first_name }}</td>
                <td>
                    <span class="status-badge {% if inspection.status == 'new' %}status-pending{% elif inspection.status == 'in_progress' %}status-pending{% elif inspection.status == 'completed' %}status-completed{% elif inspection.status == 'canceled' %}status-urgent{% endif %}">
                        {% if inspection.status == 'new' %}–ù–æ–≤–∞—è{% elif inspection.status == 'in_progress' %}–í –ø—Ä–æ—Ü–µ—Å—Å–µ{% elif inspection.status == 'completed' %}–ó–∞–≤–µ—Ä—à–µ–Ω–∞{% elif inspection.status == 'canceled' %}–û—Ç–º–µ–Ω–µ–Ω–∞{% endif %}
                    </span>
                </td>
                <td>
                    {% if inspection.findings_count %}
                    {{ inspection.findings_count }}
                    <span class="status-badge {% if inspection.overdue_findings_count %}status-urgent{% elif inspection.findings_count == inspection.resolved_findings_count %}status-completed{% else %}status-pending{% endif %}">
                        {{ inspection.resolved_findings_count }}/{{ inspection.findings_count }}
                    </span>
            {% endif %}
                </td>
                <td>
                    <a href="{% url 'inspection_detail' inspection.id %}" class="icon-btn" title="–ü—Ä–æ—Å–º–æ—Ç—Ä"><span class="btn-icon">üëÅÔ∏è</span></a>
                    <a href="{% url 'inspection_update' inspection.id %}" class="icon-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><span class="btn-icon">‚úèÔ∏è</span></a>
                    <a href="{% url 'inspection_delete' inspection.id %}" class="icon-btn" title="–£–¥–∞–ª–∏—Ç—å"><span class="btn-icon">üóëÔ∏è</span></a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="empty-table">–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% include 'partials/pagination.html' with page=page_obj %}
{% endblock %}
{% extends 'base.html' %}
{% load static %}
{% block title %}–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã | –û—Ä–∏–æ–Ω{% endblock %}
{% block content %}
<div class="page-header">
    <h1>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã</h1>
    <button class="action-btn" onclick="location.href='{% url 'medical_exam_create' %}'">–î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–æ—Å–º–æ—Ç—Ä</button>
</div>
<div class="filter-bar">
    <form method="get" action="{% url 'medical_exam_list' %}">
        <div class="filter-group">
            <label for="department">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:</label>
            <select name="department" id="department" class="form-control" onchange="this.form.submit()">
                <option value="">–í—Å–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</option>
                {% for dept in departments %}
                <option value="{{ dept.id }}" {% if department_filter == dept.id|stringformat:"i" %}selected{% endif %}>{{ dept.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="filter-group">
            <label for="status">–°—Ç–∞—Ç—É—Å:</label>
            <select name="status" id="status" class="form-control" onchange="this.form.submit()">
                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                <option value="overdue" {% if status_filter == 'overdue' %}selected{% endif %}>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</option>
                <option value="upcoming" {% if status_filter == 'upcoming' %}selected{% endif %}>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ</option>
                <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
            </select>
        </div>
    </form>
</div>
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                <th>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
                <th>–î–∞—Ç–∞ –æ—Å–º–æ—Ç—Ä–∞</th>
                <th>–°–ª–µ–¥—É—é—â–∏–π –æ—Å–º–æ—Ç—Ä</th>
                <th>–¢–∏–ø –æ—Å–º–æ—Ç—Ä–∞</th>
                <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for exam in page_obj %}
            <tr>
                <td>{{ exam.employee.user.last_name }} {{ exam.employee.user.first_name }}</td>
                <td>{{ exam.employee.department.name }}</td>
                <td>{{ exam.exam_date|date:"d.m.Y" }}</td>
                <td>{{ exam.next_exam_date|date:"d.m.Y" }}</td>
                <td>{{ exam.exam_type }}</td>
                <td>{{ exam.result }}</td>
                <td>
                    <span class="status-badge 
                        {% if exam.next_exam_date < current_date %}status-urgent
                        {% elif exam.next_exam_date < next_month %}status-pending
                        {% else %}status-completed{% endif %}">
                        {% if exam.next_exam_date < current_date %}–ü—Ä–æ—Å—Ä–æ—á–µ–Ω
                        {% elif exam.next_exam_date < next_month %}–°–∫–æ—Ä–æ
                        {% else %}–í –Ω–æ—Ä–º–µ{% endif %}
                    </span>
                </td>
                <td>
                    <a href="{% url 'medical_exam_detail' exam.id %}" class="icon-btn" title="–ü—Ä–æ—Å–º–æ—Ç—Ä"><span class="btn-icon">üëÅÔ∏è</span></a>
                    <a href="{% url 'medical_exam_update' exam.id %}" class="icon-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><span class="btn-icon">‚úèÔ∏è</span></a>
                    <a href="{% url 'medical_exam_delete' exam.id %}" class="icon-btn" title="–£–¥–∞–ª–∏—Ç—å"><span class="btn-icon">üóëÔ∏è</span></a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="empty-table">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Å–º–æ—Ç—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% include 'partials/pagination.html' with page=page_obj %}
<style>
    .status-urgent {
        background-color: #ffe6e6;
        color: #f44336;
    }
    .status-pending {
        background-color: #fff5e6;
        color: #ff9800;
    }
    .status-completed {
        background-color: #e6f7e6;
        color: #4caf50;
    }
</style>
{% endblock %}
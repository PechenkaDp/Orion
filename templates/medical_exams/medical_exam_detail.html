{% extends 'base.html' %}
{% load static %}
{% block title %}–ú–µ–¥–æ—Å–º–æ—Ç—Ä: {{ medical_exam.employee.user.last_name }} {{ medical_exam.employee.user.first_name }} | –û—Ä–∏–æ–Ω{% endblock %}
{% block content %}
<div class="page-header">
    <h1>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –æ—Å–º–æ—Ç—Ä</h1>
    <div class="action-buttons">
        <a href="{% url 'medical_exam_update' medical_exam.id %}" class="action-btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'medical_exam_delete' medical_exam.id %}" class="action-btn btn-danger">–£–¥–∞–ª–∏—Ç—å</a>
    </div>
</div>
<div class="detail-container">
    <div class="detail-card">
        <div class="detail-header">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ–¥–æ—Å–º–æ—Ç—Ä–µ</h2>
            <span class="status-badge
                {% if medical_exam.next_exam_date < current_date %}status-urgent
                {% elif medical_exam.next_exam_date < next_month %}status-pending
                {% else %}status-completed{% endif %}">
                {% if medical_exam.next_exam_date < current_date %}–ü—Ä–æ—Å—Ä–æ—á–µ–Ω
                {% elif medical_exam.next_exam_date < next_month %}–°–∫–æ—Ä–æ
                {% else %}–í –Ω–æ—Ä–º–µ{% endif %}
            </span>
        </div>
    <div class="detail-content">
        <div class="detail-row">
            <div class="detail-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</div>
            <div class="detail-value">{{ medical_exam.employee.user.last_name }} {{ medical_exam.employee.user.first_name }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:</div>
            <div class="detail-value">{{ medical_exam.employee.department.name }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</div>
            <div class="detail-value">{{ medical_exam.employee.position }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–î–∞—Ç–∞ –æ—Å–º–æ—Ç—Ä–∞:</div>
            <div class="detail-value">{{ medical_exam.exam_date|date:"d.m.Y" }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Å–º–æ—Ç—Ä–∞:</div>
            <div class="detail-value {% if medical_exam.next_exam_date < current_date %}overdue{% endif %}">
                {{ medical_exam.next_exam_date|date:"d.m.Y" }}
                {% if medical_exam.next_exam_date < current_date %}
                <span class="status-badge status-urgent">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω</span>
                {% endif %}
            </div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–¢–∏–ø –æ—Å–º–æ—Ç—Ä–∞:</div>
            <div class="detail-value">{{ medical_exam.exam_type }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ:</div>
            <div class="detail-value">{{ medical_exam.medical_facility }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–í—Ä–∞—á:</div>
            <div class="detail-value">{{ medical_exam.doctor|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
            <div class="detail-value">{{ medical_exam.result }}</div>
        </div>
        {% if medical_exam.recommendations %}
        <div class="detail-row">
            <div class="detail-label">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</div>
            <div class="detail-value">{{ medical_exam.recommendations }}</div>
        </div>
        {% endif %}
        {% if medical_exam.restrictions %}
        <div class="detail-row">
            <div class="detail-label">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</div>
            <div class="detail-value">{{ medical_exam.restrictions }}</div>
        </div>
        {% endif %}
        {% if medical_exam.document %}
        <div class="detail-row">
            <div class="detail-label">–î–æ–∫—É–º–µ–Ω—Ç:</div>
            <div class="detail-value">
                <a href="{{ medical_exam.document.url }}" class="file-link" target="_blank">–°–∫–∞—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</a>
            </div>
        </div>
        {% endif %}
        {% if medical_exam.notes %}
        <div class="detail-row">
            <div class="detail-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</div>
            <div class="detail-value">{{ medical_exam.notes }}</div>
        </div>
        {% endif %}
    </div>
</div>

<div class="detail-card">
    <div class="detail-header">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
    </div>
    <div class="detail-content">
        <table class="detail-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–ú–µ–¥—É—á—Ä–µ–∂–¥–µ–Ω–∏–µ</th>
                    <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for exam in employee_exams %}
                <tr {% if exam.id == medical_exam.id %}class="active-row"{% endif %}>
                    <td>{{ exam.exam_date|date:"d.m.Y" }}</td>
                    <td>{{ exam.exam_type }}</td>
                    <td>{{ exam.medical_facility }}</td>
                    <td>{{ exam.result }}</td>
                    <td>
                        <a href="{% url 'medical_exam_detail' exam.id %}" class="icon-btn" title="–ü—Ä–æ—Å–º–æ—Ç—Ä"><span class="btn-icon">üëÅÔ∏è</span></a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="empty-table">–ò—Å—Ç–æ—Ä–∏—è –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</div>
<style>
    .overdue {
        color: #f44336;
        font-weight: bold;
    }

    .active-row {
        background-color: #fff8e1;
    }

    .file-link {
        color: #ff7a00;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
    }

    .file-link:hover {
        text-decoration: underline;
    }

    .file-link:before {
        content: 'üìÑ';
        margin-right: 5px;
    }
</style>
{% endblock %}